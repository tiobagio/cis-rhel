# This file contains the auditctl rules that are loaded
# whenever the audit daemon is started via the initscripts.
# The rules are simply the parameters that would be passed
# to auditctl.

# First rule - delete all
-D

# Increase the buffers to survive stress events.
# Make this bigger for busy systems
-b <%= node['auditd']['backlog'] %>

# Feel free to add below this line. See auditctl man page

# CIS Benchmark Adjustments

# 4.1.4_Ensure_events_that_modify_date_and_time_information_are_collected
<% node['auditd']['collect_events_that_modify_date_and_time'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.5_Ensure_events_that_modify_usergroup_information_are_collected
<% node['auditd']['collect_events_that_modify_usergroup'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.6_Ensure_events_that_modify_the_systems_network_environment_are_collected
<% node['auditd']['collect_events_that_modify_the_systems_network_environment'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.7_Ensure_events_that_modify_the_systems_Mandatory_Access_Controls_are_collected
<% node['auditd']['collect_events_that_modify_the_systems_MAC'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.8_Ensure_login_and_logout_events_are_collected
<% node['auditd']['collect_login_and_logout_events'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.9_Ensure_session_initiation_information_is_collected
<% node['auditd']['collect_session_initiation_information'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.10_Ensure_discretionary_access_control_permission_modification_events_are_collected
<% node['auditd']['collect_DAC_permission_modification_events'].each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.11_Ensure_unsuccessful_unauthorized_file_access_attempts_are_collected
<% node['auditd']['collect_unsuccessful_unauthorized_file_access_attempts'].each do |rule| %>
  <%= rule %>
<% end %>s

# 4.1.12_Ensure_use_of_privileged_commands_is_collected
<% @privileged_programs.each do |rule| %>
  <%= rule %>
<% end %>

# 4.1.13_Ensure_successful_file_system_mounts_are_collected
<% node['auditd']['collect_successful_file_system_mounts'].each do |rule| %>
  <%= rule %>
<% end %>s


# 4.1.14_Ensure_file_deletion_events_by_users_are_collected
<% node['auditd']['collect_file_deletion_events_by_users'].each do |rule| %>
  <%= rule %>
<% end %>s

# 4.1.15_Ensure_changes_to_system_administration_scope_sudoers_is_collected
<% node['auditd']['collect_changes_to_system_admin_scope_sudoers'].each do |rule| %>
  <%= rule %>
<% end %>s

# 4.1.16_Ensure_system_administrator_actions_sudolog_are_collected
<% node['auditd']['collect_system_admin_scope_actions_sudolog'].each do |rule| %>
  <%= rule %>
<% end %>s

# 4.1.17_Ensure_kernel_module_loading_and_unloading_is_collected
<% node['auditd']['collect_kernel_module_loading_and_unloading'].each do |rule| %>
  <%= rule %>
<% end %>s

# 4.1.18_Ensure_the_audit_configuration_is_immutable
<%= node['auditd']['audit_configuration_is_immutable'] %>
